<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
  </head>
  <body class="mixpanel-platform-body">
    <div class="mixpanel-platform-section">
      
    <div id="dateSelect" style="float: right;"></div>
    
    </div>
    <script>
      /* 
      Requirements: 
      - Table 1:
      - Table 2: number of users in each category (beginner is 1-3)
      - Table 3: cumulative users ( beginner is > 1)
        - include conversion rate, i.e. the percentage of advanced who were beginner 
      */ 
      
      /* Variables */
      var dateSelect  = $('#dateSelect').MPDatepicker();
      var dateRange = dateSelect.MPDatepicker('value');
      var eventName = '$custom_event:64721';
      var beginnerParams = {
        to:dateRange.to,
        from:dateRange.from,
        type:'unique',
        unit:'month',
        frequency:(0,4)
      };
      var activeParams = {
        to:dateRange.to,
        from:dateRange.from,
        type:'unique',
        unit:'month',
        frequency:(3,20)
      };
      var engagedParams = {
        to:dateRange.to,
        from:dateRange.from,
        type:'unique',
        unit:'month',
        frequency:(19,80)
      };
      var highlyEngagedParams = {
        to:dateRange.to,
        from:dateRange.from,
        type:'unique',
        unit:'month',
        frequency:80
      };
      var queriesComplete = 0;

      /* Query */
      //TODO: want to run the query on load 
      var runQuery = function() {
        var finalStruct = [];
         MP.api.segment(eventName, null, beginnerParams).done(function(results) {
           finalStruct.push(results.values());
           MP.api.segment(eventName, null, activeParams).done(function(results2) {
             finalStruct.push(results2.values());
             MP.api.segment(eventName, null, engagedParams).done(function(results3) {
               finalStruct.push(results3.values());
               MP.api.segment(eventName, null, highlyEngagedParams).done(function(results4) {
                finalStruct.push(results4.values());
                calculateOutputs(finalStruct);
               });
             });
           });
         });
      };
      
      function calculateOutputs(outputStructure){
        console.log(outputStructure);
      }
      
      
      dateSelect.on('change', runQuery);
    </script>
  </body>
</html>
